<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html lang="en" >
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Windows Project</title>
    <style>
      .position_debug {
        position: fixed;
        top: 40px;
        font-size: 40px;
        color: white;
        z-index: 99; /* on top of everything */
      }
    </style>
  </head>
  <body>
    <script src="headtrackr.js"></script>
    <script src="jquery-1.11.3.min.js"></script>

    <span id="x_debug" class="position_debug" style="left:100px;">x</span>
    <span id="y_debug" class="position_debug" style="left:250px;">y</span>
    <!-- <span id="z_debug" class="position_debug">z</span> -->

    <canvas id="inputCanvas" width="320" height="240" style="display:none;"></canvas>
    <!-- <video id="inputVideo" autoplay loop width="320" height="240"></video> -->
    <video id="inputVideo" autoplay loop width="320" height="240"
           style="position:fixed; bottom:0; right:200px; z-index:2;"></video>
    
    <!-- <input type="image" src="http://68.181.172.237/nphMotionJpeg?Resolution=640x480&Quality=Standard" width="640" height="480" border="0"> -->
    <input id="video_stream" type="image"
           src="http://68.181.172.237/nphMotionJpeg?Resolution=640x480&Quality=Standard"
           width="250%"
           style="position:relative;
           margin-left:-75%;
           margin-top:-15%" border="0">

    <script type="text/javascript">
  		var videoInput = document.getElementById('inputVideo');
  		var canvasInput = document.getElementById('inputCanvas');
  		
  		var $x_debug = $("#x_debug");
  		var $y_debug = $("#y_debug");
  		var $z_debug = $("#z_debug");
  
  		var htracker = new headtrackr.Tracker();
  		htracker.init(videoInput, canvasInput);
  		htracker.start();
  		
      function enforceCoordinateBoundX(coord) {
        // cap to -20 and 20 to prevent any wild movements
        coord = parseFloat(coord);
        var CEILING = 30;
        var FLOOR = -30;
        if (coord > 0) {
          coord = Math.min(coord, CEILING);
        } else {
          coord = Math.max(coord, FLOOR);
        }
        return coord;
      }
      function enforceCoordinateBoundY(coord) {
        // cap to -20 and 20 to prevent any wild movements
        coord = parseFloat(coord);
        var CEILING = 20;
        var FLOOR = -8;
        if (coord > 0) {
          coord = Math.min(coord, CEILING);
        } else {
          coord = Math.max(coord, FLOOR);
        }
        return coord;
      }

  		document.addEventListener('headtrackingEvent',
  		  function (event) {
          var x = event.x;
          var y = event.y;

          console.log(x);
          console.log(y);

          // x = enforceCoordinateBoundX(x);
          // y = enforceCoordinateBoundY(y);

  		    $x_debug.text(parseFloat(x).toFixed(2));
          $y_debug.text(parseFloat(y).toFixed(2));

          var adjustedX = x * 12;
          var adjustedY = y * 6;

  		    $("#video_stream").css('left', adjustedX + "px");
  		    $("#video_stream").css('top', adjustedY + "px");
  		    
  		    //z.text(parseFloat(event.z).toFixed(2));
  		    // console.log("z:" + event.z);
  		    //z.text(100 + event.z + "%");
  		    //$("#video_stream").css('width', 50 + event.z + "%");    
  		  }
      );
    </script>

  </body>

</html>

